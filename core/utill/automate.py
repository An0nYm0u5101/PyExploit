''' This file is part of PyExploit '''

from time import sleep
from sys import exit as exits

from core.utill.parser import shodan_parser, pwned_parser
from core.utill.workspaces import WorkPlace

from core.style import (doing, success, error, SAVE)


def automate(domain):
    ''' Automate recon process '''
    from modules.recon.passive.hackertarget import hackertarget
    from modules.recon.passive.shodan import (Shodan, key)
    from modules.recon.passive.whois import whois
    from modules.recon.passive.geoip import geoip
    from modules.recon.passive.pwned import pwned
    from modules.recon.passive.gdork import gdork
    workplace = WorkPlace(domain)
    workplace.my_work()

    doing("Whois query")
    whois_result = whois(domain)
    if whois_result != 0:
        success(whois_result)
        workplace.reporter('whois', whois_result)
    else:
        error("Something went wrong")

    doing("GEOIP")
    geoip_result = geoip(domain)
    if geoip_result != 0:
        workplace.reporter('GeoIP', geoip_result)
        success(geoip_result)
    else:
        error("Somthing went wrong")

    sleep(1)
    doing("Subdomain enumeration")
    hackertarget_result = hackertarget(domain)
    if hackertarget_result != 0:
        workplace.reporter('subdomains', hackertarget_result)
        success(hackertarget_result)
    if hackertarget_result == 0:
        error("Something went worng")

    sleep(1)
    doing("Getting targets from Shodan")
    shodan_result = shodan_parser(Shodan(domain))
    if shodan_result != 0:
        workplace.reporter('shodan', ' '.join(shodan_result))
        success("Result")
        for item in shodan_result:
            print(item)
    if shodan_result == 0:
        pass
    else:
        if key() == 0:
            error("Please add your api key")
        else:
            error("Something went wrong")
            exits()

    sleep(1)
    doing("Checking if the target is pwned")
    pwned_result = pwned_parser(pwned(domain))
    if isinstance(pwned_result, str):
        workplace.reporter('pwned', pwned_result)
        success(pwned_result)
    if pwned_result != 9:
        error("No breach")
    else:
        error("Something went wrong")

    sleep(1)
    doing("Google dorking")
    dorks = gdork(domain)
    if isinstance(dorks, str):
        workplace.reporter('dorks', dorks)
        success(dorks)
    else:
        error("something went wrong")

    success(f"Workplace saved in : {workplace.name}")

    exits()
